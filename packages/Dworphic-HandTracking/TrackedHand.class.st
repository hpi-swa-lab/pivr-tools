Class {
	#name : #TrackedHand,
	#superclass : #GRComponent,
	#instVars : [
		'rootNode'
	],
	#category : #'Dworphic-HandTracking'
}

{ #category : #'as yet unclassified' }
TrackedHand >> a1000CommonEnglishWordList [

	^ {
	'a'.
	'ability'.
	'able'.
	'about'.
	'above'.
	'accept'.
	'according'.
	'account'.
	'across'.
	'act'.
	'action'.
	'activity'.
	'actually'.
	'add'.
	'address'.
	'administration'.
	'admit'.
	'adult'.
	'affect'.
	'after'.
	'again'.
	'against'.
	'age'.
	'agency'.
	'agent'.
	'ago'.
	'agree'.
	'agreement'.
	'ahead'.
	'air'.
	'all'.
	'allow'.
	'almost'.
	'alone'.
	'along'.
	'already'.
	'also'.
	'although'.
	'always'.
	'American'.
	'among'.
	'amount'.
	'analysis'.
	'and'.
	'animal'.
	'another'.
	'answer'.
	'any'.
	'anyone'.
	'anything'.
	'appear'.
	'apply'.
	'approach'.
	'area'.
	'argue'.
	'arm'.
	'around'.
	'arrive'.
	'art'.
	'article'.
	'artist'.
	'as'.
	'ask'.
	'assume'.
	'at'.
	'attack'.
	'attention'.
	'attorney'.
	'audience'.
	'author'.
	'authority'.
	'available'.
	'avoid'.
	'away'.
	'baby'.
	'back'.
	'bad'.
	'bag'.
	'ball'.
	'bank'.
	'bar'.
	'base'.
	'be'.
	'beat'.
	'beautiful'.
	'because'.
	'become'.
	'bed'.
	'before'.
	'begin'.
	'behavior'.
	'behind'.
	'believe'.
	'benefit'.
	'best'.
	'better'.
	'between'.
	'beyond'.
	'big'.
	'bill'.
	'billion'.
	'bit'.
	'black'.
	'blood'.
	'blue'.
	'board'.
	'body'.
	'book'.
	'born'.
	'both'.
	'box'.
	'boy'.
	'break'.
	'bring'.
	'brother'.
	'budget'.
	'build'.
	'building'.
	'business'.
	'but'.
	'buy'.
	'by'.
	'call'.
	'camera'.
	'campaign'.
	'can'.
	'cancer'.
	'candidate'.
	'capital'.
	'car'.
	'card'.
	'care'.
	'career'.
	'carry'.
	'case'.
	'catch'.
	'cause'.
	'cell'.
	'center'.
	'central'.
	'century'.
	'certain'.
	'certainly'.
	'chair'.
	'challenge'.
	'chance'.
	'change'.
	'character'.
	'charge'.
	'check'.
	'child'.
	'choice'.
	'choose'.
	'church'.
	'citizen'.
	'city'.
	'civil'.
	'claim'.
	'class'.
	'clear'.
	'clearly'.
	'close'.
	'coach'.
	'cold'.
	'collection'.
	'college'.
	'color'.
	'come'.
	'commercial'.
	'common'.
	'community'.
	'company'.
	'compare'.
	'computer'.
	'concern'.
	'condition'.
	'conference'.
	'Congress'.
	'consider'.
	'consumer'.
	'contain'.
	'continue'.
	'control'.
	'cost'.
	'could'.
	'country'.
	'couple'.
	'course'.
	'court'.
	'cover'.
	'create'.
	'crime'.
	'cultural'.
	'culture'.
	'cup'.
	'current'.
	'customer'.
	'cut'.
	'dark'.
	'data'.
	'daughter'.
	'day'.
	'dead'.
	'deal'.
	'death'.
	'debate'.
	'decade'.
	'decide'.
	'decision'.
	'deep'.
	'defense'.
	'degree'.
	'Democrat'.
	'democratic'.
	'describe'.
	'design'.
	'despite'.
	'detail'.
	'determine'.
	'develop'.
	'development'.
	'die'.
	'difference'.
	'different'.
	'difficult'.
	'dinner'.
	'direction'.
	'director'.
	'discover'.
	'discuss'.
	'discussion'.
	'disease'.
	'do'.
	'doctor'.
	'dog'.
	'door'.
	'down'.
	'draw'.
	'dream'.
	'drive'.
	'drop'.
	'drug'.
	'during'.
	'each'.
	'early'.
	'east'.
	'easy'.
	'eat'.
	'economic'.
	'economy'.
	'edge'.
	'education'.
	'effect'.
	'effort'.
	'eight'.
	'either'.
	'election'.
	'else'.
	'employee'.
	'end'.
	'energy'.
	'enjoy'.
	'enough'.
	'enter'.
	'entire'.
	'environment'.
	'environmental'.
	'especially'.
	'establish'.
	'even'.
	'evening'.
	'event'.
	'ever'.
	'every'.
	'everybody'.
	'everyone'.
	'everything'.
	'evidence'.
	'exactly'.
	'example'.
	'executive'.
	'exist'.
	'expect'.
	'experience'.
	'expert'.
	'explain'.
	'eye'.
	'face'.
	'fact'.
	'factor'.
	'fail'.
	'fall'.
	'family'.
	'far'.
	'fast'.
	'father'.
	'fear'.
	'federal'.
	'feel'.
	'feeling'.
	'few'.
	'field'.
	'fight'.
	'figure'.
	'fill'.
	'film'.
	'final'.
	'finally'.
	'financial'.
	'find'.
	'fine'.
	'finger'.
	'finish'.
	'fire'.
	'firm'.
	'first'.
	'fish'.
	'five'.
	'floor'.
	'fly'.
	'focus'.
	'follow'.
	'food'.
	'foot'.
	'for'.
	'force'.
	'foreign'.
	'forget'.
	'form'.
	'former'.
	'forward'.
	'four'.
	'free'.
	'friend'.
	'from'.
	'front'.
	'full'.
	'fund'.
	'future'.
	'game'.
	'garden'.
	'gas'.
	'general'.
	'generation'.
	'get'.
	'girl'.
	'give'.
	'glass'.
	'go'.
	'goal'.
	'good'.
	'government'.
	'great'.
	'green'.
	'ground'.
	'group'.
	'grow'.
	'growth'.
	'guess'.
	'gun'.
	'guy'.
	'hair'.
	'half'.
	'hand'.
	'hang'.
	'happen'.
	'happy'.
	'hard'.
	'have'.
	'he'.
	'head'.
	'health'.
	'hear'.
	'heart'.
	'heat'.
	'heavy'.
	'help'.
	'her'.
	'here'.
	'herself'.
	'high'.
	'him'.
	'himself'.
	'his'.
	'history'.
	'hit'.
	'hold'.
	'home'.
	'hope'.
	'hospital'.
	'hot'.
	'hotel'.
	'hour'.
	'house'.
	'how'.
	'however'.
	'huge'.
	'human'.
	'hundred'.
	'husband'.
	'I'.
	'idea'.
	'identify'.
	'if'.
	'image'.
	'imagine'.
	'impact'.
	'important'.
	'improve'.
	'in'.
	'include'.
	'including'.
	'increase'.
	'indeed'.
	'indicate'.
	'individual'.
	'industry'.
	'information'.
	'inside'.
	'instead'.
	'institution'.
	'interest'.
	'interesting'.
	'international'.
	'interview'.
	'into'.
	'investment'.
	'involve'.
	'issue'.
	'it'.
	'item'.
	'its'.
	'itself'.
	'job'.
	'join'.
	'just'.
	'keep'.
	'key'.
	'kid'.
	'kill'.
	'kind'.
	'kitchen'.
	'know'.
	'knowledge'.
	'land'.
	'language'.
	'large'.
	'last'.
	'late'.
	'later'.
	'laugh'.
	'law'.
	'lawyer'.
	'lay'.
	'lead'.
	'leader'.
	'learn'.
	'least'.
	'leave'.
	'left'.
	'leg'.
	'legal'.
	'less'.
	'let'.
	'letter'.
	'level'.
	'lie'.
	'life'.
	'light'.
	'like'.
	'likely'.
	'line'.
	'list'.
	'listen'.
	'little'.
	'live'.
	'local'.
	'long'.
	'look'.
	'lose'.
	'loss'.
	'lot'.
	'love'.
	'low'.
	'machine'.
	'magazine'.
	'main'.
	'maintain'.
	'major'.
	'majority'.
	'make'.
	'man'.
	'manage'.
	'management'.
	'manager'.
	'many'.
	'market'.
	'marriage'.
	'material'.
	'matter'.
	'may'.
	'maybe'.
	'me'.
	'mean'.
	'measure'.
	'media'.
	'medical'.
	'meet'.
	'meeting'.
	'member'.
	'memory'.
	'mention'.
	'message'.
	'method'.
	'middle'.
	'might'.
	'military'.
	'million'.
	'mind'.
	'minute'.
	'miss'.
	'mission'.
	'model'.
	'modern'.
	'moment'.
	'money'.
	'month'.
	'more'.
	'morning'.
	'most'.
	'mother'.
	'mouth'.
	'move'.
	'movement'.
	'movie'.
	'Mr'.
	'Mrs'.
	'much'.
	'music'.
	'must'.
	'my'.
	'myself'.
	'name'.
	'nation'.
	'national'.
	'natural'.
	'nature'.
	'near'.
	'nearly'.
	'necessary'.
	'need'.
	'network'.
	'never'.
	'new'.
	'news'.
	'newspaper'.
	'next'.
	'nice'.
	'night'.
	'no'.
	'none'.
	'nor'.
	'north'.
	'not'.
	'note'.
	'nothing'.
	'notice'.
	'now'.
	'n’t'.
	'number'.
	'occur'.
	'of'.
	'off'.
	'offer'.
	'office'.
	'officer'.
	'official'.
	'often'.
	'oh'.
	'oil'.
	'ok'.
	'old'.
	'on'.
	'once'.
	'one'.
	'only'.
	'onto'.
	'open'.
	'operation'.
	'opportunity'.
	'option'.
	'or'.
	'order'.
	'organization'.
	'other'.
	'others'.
	'our'.
	'out'.
	'outside'.
	'over'.
	'own'.
	'owner'.
	'page'.
	'pain'.
	'painting'.
	'paper'.
	'parent'.
	'part'.
	'participant'.
	'particular'.
	'particularly'.
	'partner'.
	'party'.
	'pass'.
	'past'.
	'patient'.
	'pattern'.
	'pay'.
	'peace'.
	'people'.
	'per'.
	'perform'.
	'performance'.
	'perhaps'.
	'period'.
	'person'.
	'personal'.
	'phone'.
	'physical'.
	'pick'.
	'picture'.
	'piece'.
	'place'.
	'plan'.
	'plant'.
	'play'.
	'player'.
	'PM'.
	'point'.
	'police'.
	'policy'.
	'political'.
	'politics'.
	'poor'.
	'popular'.
	'population'.
	'position'.
	'positive'.
	'possible'.
	'power'.
	'practice'.
	'prepare'.
	'present'.
	'president'.
	'pressure'.
	'pretty'.
	'prevent'.
	'price'.
	'private'.
	'probably'.
	'problem'.
	'process'.
	'produce'.
	'product'.
	'production'.
	'professional'.
	'professor'.
	'program'.
	'project'.
	'property'.
	'protect'.
	'prove'.
	'provide'.
	'public'.
	'pull'.
	'purpose'.
	'push'.
	'put'.
	'quality'.
	'question'.
	'quickly'.
	'quite'.
	'race'.
	'radio'.
	'raise'.
	'range'.
	'rate'.
	'rather'.
	'reach'.
	'read'.
	'ready'.
	'real'.
	'reality'.
	'realize'.
	'really'.
	'reason'.
	'receive'.
	'recent'.
	'recently'.
	'recognize'.
	'record'.
	'red'.
	'reduce'.
	'reflect'.
	'region'.
	'relate'.
	'relationship'.
	'religious'.
	'remain'.
	'remember'.
	'remove'.
	'report'.
	'represent'.
	'Republican'.
	'require'.
	'research'.
	'resource'.
	'respond'.
	'response'.
	'responsibility'.
	'rest'.
	'result'.
	'return'.
	'reveal'.
	'rich'.
	'right'.
	'rise'.
	'risk'.
	'road'.
	'rock'.
	'role'.
	'room'.
	'rule'.
	'run'.
	'safe'.
	'same'.
	'save'.
	'say'.
	'scene'.
	'school'.
	'science'.
	'scientist'.
	'score'.
	'sea'.
	'season'.
	'seat'.
	'second'.
	'section'.
	'security'.
	'see'.
	'seek'.
	'seem'.
	'sell'.
	'send'.
	'senior'.
	'sense'.
	'series'.
	'serious'.
	'serve'.
	'service'.
	'set'.
	'seven'.
	'several'.
	'sex'.
	'sexual'.
	'shake'.
	'share'.
	'she'.
	'shoot'.
	'short'.
	'shot'.
	'should'.
	'shoulder'.
	'show'.
	'side'.
	'sign'.
	'significant'.
	'similar'.
	'simple'.
	'simply'.
	'since'.
	'sing'.
	'single'.
	'sister'.
	'sit'.
	'site'.
	'situation'.
	'six'.
	'size'.
	'skill'.
	'skin'.
	'small'.
	'smile'.
	'so'.
	'social'.
	'society'.
	'soldier'.
	'some'.
	'somebody'.
	'someone'.
	'something'.
	'sometimes'.
	'son'.
	'song'.
	'soon'.
	'sort'.
	'sound'.
	'source'.
	'south'.
	'southern'.
	'space'.
	'speak'.
	'special'.
	'specific'.
	'speech'.
	'spend'.
	'sport'.
	'spring'.
	'staff'.
	'stage'.
	'stand'.
	'standard'.
	'star'.
	'start'.
	'state'.
	'statement'.
	'station'.
	'stay'.
	'step'.
	'still'.
	'stock'.
	'stop'.
	'store'.
	'story'.
	'strategy'.
	'street'.
	'strong'.
	'structure'.
	'student'.
	'study'.
	'stuff'.
	'style'.
	'subject'.
	'success'.
	'successful'.
	'such'.
	'suddenly'.
	'suffer'.
	'suggest'.
	'summer'.
	'support'.
	'sure'.
	'surface'.
	'system'.
	'table'.
	'take'.
	'talk'.
	'task'.
	'tax'.
	'teach'.
	'teacher'.
	'team'.
	'technology'.
	'television'.
	'tell'.
	'ten'.
	'tend'.
	'term'.
	'test'.
	'than'.
	'thank'.
	'that'.
	'the'.
	'their'.
	'them'.
	'themselves'.
	'then'.
	'theory'.
	'there'.
	'these'.
	'they'.
	'thing'.
	'think'.
	'third'.
	'this'.
	'those'.
	'though'.
	'thought'.
	'thousand'.
	'threat'.
	'three'.
	'through'.
	'throughout'.
	'throw'.
	'thus'.
	'time'.
	'to'.
	'today'.
	'together'.
	'tonight'.
	'too'.
	'top'.
	'total'.
	'tough'.
	'toward'.
	'town'.
	'trade'.
	'traditional'.
	'training'.
	'travel'.
	'treat'.
	'treatment'.
	'tree'.
	'trial'.
	'trip'.
	'trouble'.
	'true'.
	'truth'.
	'try'.
	'turn'.
	'TV'.
	'two'.
	'type'.
	'under'.
	'understand'.
	'unit'.
	'until'.
	'up'.
	'upon'.
	'us'.
	'use'.
	'usually'.
	'value'.
	'various'.
	'very'.
	'victim'.
	'view'.
	'violence'.
	'visit'.
	'voice'.
	'vote'.
	'wait'.
	'walk'.
	'wall'.
	'want'.
	'war'.
	'watch'.
	'water'.
	'way'.
	'we'.
	'weapon'.
	'wear'.
	'week'.
	'weight'.
	'well'.
	'west'.
	'western'.
	'what'.
	'whatever'.
	'when'.
	'where'.
	'whether'.
	'which'.
	'while'.
	'white'.
	'who'.
	'whole'.
	'whom'.
	'whose'.
	'why'.
	'wide'.
	'wife'.
	'will'.
	'win'.
	'wind'.
	'window'.
	'wish'.
	'with'.
	'within'.
	'without'.
	'woman'.
	'wonder'.
	'word'.
	'work'.
	'worker'.
	'world'.
	'worry'.
	'would'.
	'write'.
	'writer'.
	'wrong'.
	'yard'.
	'yeah'.
	'year'.
	'yes'.
	'yet'.
	'you'.
	'young'.
	'your'.
	'yourself'.
}
]

{ #category : #'as yet unclassified' }
TrackedHand >> buildTree: aListOfWords [
	
	| currentNode |
	rootNode := CharGroupNode newFromFingerName: ''.
	
	aListOfWords do: [:word |
		currentNode := rootNode.
		word do: [:char | 
			currentNode := currentNode getChild: (self fingerCharacterMapping at: (char asString)).
		].
		currentNode words add: word.
	].
]

{ #category : #'as yet unclassified' }
TrackedHand >> fingerCharacterMapping [
	^ Dictionary newFromPairs: {
		'q'. 1. 'a'. 1. 'y'. 1. 							"LeftLittle"
		'w'. 2. 's'. 2. 'x'. 2. 							"LeftRing"
		'e'. 3. 'd'. 3. 'c'. 3. 							"LeftMiddle"
		't'. 4. 'r'. 4. 'f'. 4. 'g'. 4. 'v'. 4. 'b'. 4. 		"LeftIndex"
		'z'. 5. 'u'. 5. 'h'. 5. 'j'. 5. 'n'. 5. 'm'. 5. 		"RightIndex"
		'i'. 6. 'k'. 6. 								"RightMiddle"
		'o'. 7. 'p'. 7. 'l'. 7. 							"RightRing"
		'ü'. 8. 'ö'. 8. 'ä'. 8							"RightLittle"
	}
]

{ #category : #'as yet unclassified' }
TrackedHand >> oldFingerCharacterMapping [

	^ Dictionary newFromPairs: {
		'Littleleft'. 'a'.
		'Ringleft'. 's'.
		'Middleleft'. 'd'.
		'Indexleft'. 'f'.
		'Littleright'. 'o'.
		'Ringright'. 'l'.
		'Middleright'. 'k'.
		'Indexright'. 'j'.
	}
]

{ #category : #'as yet unclassified' }
TrackedHand >> render: props [ 
	| node finger rootRef area tipRefs metacarpalPos proximalPos tipPos waitForRelease angle log |
	node := [GDMeshInstance new].
	area := [GDArea new children: {self cubeOfSize: 0.01 color: Color red}].
	tipRefs := self
				useState: (Dictionary newFromPairs: {'Index'. self useGodotRef. 'Middle'. self useGodotRef. 'Ring'. self useGodotRef. 'Little'. self useGodotRef}).
	log := self useLog.
	tipPos := self useState: (Vector3 zero).
	proximalPos := self useState: (Vector3 zero).
	metacarpalPos := self useState: (Vector3 zero).
	waitForRelease := self useState: false.
	
	angle := (tipPos get - proximalPos get) angleTo: (metacarpalPos get - proximalPos get).
	
	(angle < 1 and: waitForRelease get not) ifTrue: [
		log value: ((props at: #side)
							= #left
						ifTrue: Character space
						ifFalse: Character linefeed).
		waitForRelease set: true.
		].
	(angle > 2 and: waitForRelease get) ifTrue: [
		waitForRelease set: false.
		].
		
	finger := [:name | node value name: name , 'Metacarpal';
				subscribeTo: #'global_transform' do: [:pos | name = 'Middle' ifTrue: [metacarpalPos set: pos translation] ];
				 children: {node value name: name , 'Proximal';
					 subscribeTo: #'global_transform' do: [:pos | name = 'Middle' ifTrue: [proximalPos set: pos translation] ];
					 children: {node value name: name , 'Intermediate';
						 children: {node value name: name , 'Distal';
							 children: {node value name: name , 'Tip';
								subscribeTo: #'global_transform' do: [:pos | name = 'Middle' ifTrue: [tipPos set: pos translation] ];
								 children: {
											area value
									ref: (tipRefs get at: name).
									GDLabel3D new 
										billboard: GDSpatialMaterial billboardEnabled;
										noDepthTest: true;
										fixedSize: true;
										pixelSize: 0.001;
										translation: 0 @ 0.01 @ 0; text: (self fingerCharacterMapping at: (name, (props at: #side)))}}}}}].
	rootRef := self useGodotRef.
	self
		useEffect: [rootRef get
				setScript: (GRReactCurrentSession value loadResource: 'res://addons/godot-openxr/config/OpenXRHand.gdns').
			GRReactCurrentSession value
				callOn: rootRef get
				method: 'set_hand'
				arguments: {(props at: #side)
							= #left
						ifTrue: [0]
						ifFalse: [1]}.
			GRReactCurrentSession value
				callOn: rootRef get
				method: '_ready'
				arguments: {}.
			rootRef get setPhysicsProcessEnable: true]
		dependencies: {}.
	^ GDSpatial new ref: rootRef;
		 children: {node value name: 'Wrist';
			 children: {area value. node value name: 'ThumbMetacarpal';
				 children: {area value. node value name: 'ThumbProximal';
					 children: {area value. node value name: 'ThumbDistal';
						 children: {area value. node value name: 'ThumbTip';
							 children: {GDArea new children: {self cubeOfSize: 0.01 color: Color red};
								
								onAreaEntered: [:other | (tipRefs get
										associationsSelect: [:asc | asc value get = other]) associations
										ifNotEmpty: [:list | log
												value: (self fingerCharacterMapping at: list first key
															, (props at: #side))]]}}}}. finger value: 'Index'. finger value: 'Middle'. finger value: 'Ring'. finger value: 'Little'}}
]

{ #category : #'as yet unclassified' }
TrackedHand >> rootNode [

	^ rootNode
]

{ #category : #'as yet unclassified' }
TrackedHand >> rootNode: aCharGroupNode [
	rootNode := aCharGroupNode
]

{ #category : #'as yet unclassified' }
TrackedHand >> traverse: node [
	
	| allWords |
	allWords := Bag new.
	
	node children do: [:child |
		(child words isEmpty) ifFalse: [allWords add: child words].
		(child hasChildren) ifTrue: [self traverse: child].
	]
]
